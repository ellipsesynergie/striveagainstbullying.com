!function($){$.fn.flexVerticalCenter=function(onAttribute){return this.each(function(){var $this=$(this),attribute=onAttribute||"margin-top",resizer=function(){$this.css(attribute,($this.parent().height()-$this.height())/2)};resizer(),$(window).resize(resizer),$this.find("img").load(resizer)})}}(jQuery);!function($,window,document,undefined){function Plugin(element,options){this.element=element,this.options=$.extend({},defaults,options),this._defaults=defaults,this._name=pluginName,this._ignoreHashChange=!1,this.init()}var pluginName="curtain",defaults={scrollSpeed:400,bodyHeight:0,linksArray:[],mobile:!1,scrollButtons:{},controls:null,curtainLinks:".curtain-links",enableKeys:!0,easing:"swing",disabled:!1,nextSlide:function(){},prevSlide:function(){}};Plugin.prototype={init:function(){var self=this;this.$element=$(this.element),this.$li=$(this.element).find(">li"),this.$liLength=this.$li.length,self.$windowHeight=$(window).height(),self.$elDatas={},self.$document=$(document),self.$window=$(window),self.webkit=navigator.userAgent.indexOf("Chrome")>-1||navigator.userAgent.indexOf("Safari")>-1,$.Android=navigator.userAgent.match(/Android/i),$.iPhone=navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i),$.iPad=navigator.userAgent.match(/iPad/i),$.iOs4=/OS [1-4]_[0-9_]+ like Mac OS X/i.test(navigator.userAgent),($.iPhone||$.iPad||$.Android||self.options.disabled)&&(this.options.mobile=!0,this.$li.css({position:"relative"}),this.$element.find(".fixed").css({position:"absolute"})),this.scrollEl=this.options.mobile?this.$element:$.browser.mozilla||$.browser.msie?$("html"):$("body"),self.options.controls&&(self.options.scrollButtons.up=$(self.options.controls).find('[href="#up"]'),self.options.scrollButtons.down=$(self.options.controls).find('[href="#down"]'),$.iOs4||!$.iPhone&&!$.iPad||(self.$element.css({position:"fixed",top:0,left:0,right:0,bottom:0,"-webkit-overflow-scrolling":"touch",overflow:"auto"}),$(self.options.controls).css({position:"absolute"})));var callbackImageLoaded=function(){self.setDimensions(),self.$li.eq(0).addClass("current"),self.setCache(),self.options.mobile||self.$li.eq(1).length&&self.$li.eq(1).nextAll().addClass("hidden"),self.setEvents(),self.setLinks(),self.isHashIsOnList(location.hash.substring(1))};self.$element.find("img").length?self.imageLoaded(callbackImageLoaded):callbackImageLoaded()},scrollToPosition:function(direction){var position=null,self=this;if(self.scrollEl.is(":animated"))return!1;if("up"===direction||"down"==direction){var $next="up"===direction?self.$current.prev():self.$current.next();if(self.$step){self.$current.find(".current-step").length||self.$step.eq(0).addClass("current-step");var $nextStep="up"===direction?self.$current.find(".current-step").prev(".step"):self.$current.find(".current-step").next(".step");$nextStep.length&&(position=self.options.mobile?$nextStep.position().top+self.$elDatas[self.$current.index()]["data-position"]:$nextStep.position().top+self.$elDatas[self.$current.index()]["data-position"])}position=position||(self.$elDatas[$next.index()]===undefined?null:self.$elDatas[$next.index()]["data-position"]),null!==position&&self.scrollEl.animate({scrollTop:position},self.options.scrollSpeed,self.options.easing)}else if("top"===direction)self.scrollEl.animate({scrollTop:0},self.options.scrollSpeed,self.options.easing);else if("bottom"===direction)self.scrollEl.animate({scrollTop:self.options.bodyHeight},self.options.scrollSpeed,self.options.easing);else{var index=$("#"+direction).index(),speed=Math.abs(self.currentIndex-index)*4*this.options.scrollSpeed/self.$liLength;self.scrollEl.animate({scrollTop:self.$elDatas[index]["data-position"]||null},speed<=self.options.scrollSpeed?self.options.scrollSpeed:speed,this.options.easing)}},scrollEvent:function(){var self=this,docTop=self.$document.scrollTop();docTop<self.currentP&&self.currentIndex>0?(self._ignoreHashChange=!0,self.$current.prev().attr("id")&&self.setHash(self.$current.prev().attr("id")),self.$current.removeClass("current").css(self.webkit?{"-webkit-transform":"translateY(0px) translateZ(0)"}:{marginTop:0}).nextAll().addClass("hidden").end().prev().addClass("current").removeClass("hidden"),self.setCache(),self.options.prevSlide()):docTop<self.currentP+self.currentHeight?(self.webkit?self.$current.css({"-webkit-transform":"translateY("+-(docTop-self.currentP)+"px) translateZ(0)"}):self.$current.css({marginTop:-(docTop-self.currentP)}),self.$fixedLength&&(parseInt(self.$fixed.attr("data-top"),10),docTop+self.$windowHeight>=self.currentP+self.currentHeight?self.$fixed.css({position:"fixed"}):self.$fixed.css({position:"absolute",marginTop:Math.abs(docTop-self.currentP)})),self.$stepLength&&$.each(self.$step,function(i,el){return $(el).position().top+self.currentP<=docTop+5&&$(el).position().top+self.currentP+$(el).height()>=docTop+5&&!$(el).hasClass("current-step")?(self.$step.removeClass("current-step"),$(el).addClass("current-step"),!1):void 0}),self.parallaxBg&&self.$current.css({"background-position-y":docTop*self.parallaxBg}),self.$fade.length&&self.$fade.css({opacity:1-docTop/self.$fade.attr("data-fade")}),self.$slowScroll.length&&self.$slowScroll.css({"margin-top":docTop/self.$slowScroll.attr("data-slow-scroll")})):(self._ignoreHashChange=!0,self.$current.next().attr("id")&&self.setHash(self.$current.next().attr("id")),self.$current.removeClass("current").addClass("hidden").next("li").addClass("current").next("li").removeClass("hidden"),self.setCache(),self.options.nextSlide())},scrollMobileEvent:function(){var self=this,docTop=self.$element.scrollTop();docTop+10<self.currentP&&self.currentIndex>0?(self._ignoreHashChange=!0,self.$current.prev().attr("id")&&self.setHash(self.$current.prev().attr("id")),self.$current.removeClass("current").prev().addClass("current"),self.setCache(),self.options.prevSlide()):docTop+10<self.currentP+self.currentHeight?self.$stepLength&&$.each(self.$step,function(i,el){$(el).position().top+self.currentP<=docTop&&$(el).position().top+self.currentP+$(el).outerHeight()>=docTop&&($(el).hasClass("current-step")||(self.$step.removeClass("current-step"),$(el).addClass("current-step")))}):(self._ignoreHashChange=!0,self.$current.next().attr("id")&&self.setHash(self.$current.next().attr("id")),self.$current.removeClass("current").next().addClass("current"),self.setCache(),self.options.nextSlide())},setDimensions:function(){var self=this,levelHeight=0,cover=!1,height=null;self.$windowHeight=self.$window.height(),this.$li.each(function(index){var $self=$(this);if(cover=$self.hasClass("cover"),cover?($self.css({height:self.$windowHeight,zIndex:999-index}).attr("data-height",self.$windowHeight).attr("data-position",levelHeight),self.$elDatas[$self.index()]={"data-height":parseInt(self.$windowHeight,10),"data-position":parseInt(levelHeight,10)},levelHeight+=self.$windowHeight):(height=$self.outerHeight()<=self.$windowHeight?self.$windowHeight:$self.outerHeight(),$self.css({minHeight:height,zIndex:999-index}).attr("data-height",height).attr("data-position",levelHeight),self.$elDatas[$self.index()]={"data-height":parseInt(height,10),"data-position":parseInt(levelHeight,10)},levelHeight+=height),$self.find(".fixed").length){var top=$self.find(".fixed").css("top");$self.find(".fixed").attr("data-top",top)}}),this.options.mobile||this.setBodyHeight()},setEvents:function(){var self=this;$(window).on("resize",function(){self.setDimensions()}),self.options.mobile?self.$element.on("scroll",function(){self.scrollMobileEvent()}):self.$window.on("scroll",function(){self.scrollEvent()}),self.options.enableKeys&&self.$document.on("keydown",function(e){return 38===e.keyCode||37===e.keyCode?(self.scrollToPosition("up"),e.preventDefault(),!1):40===e.keyCode||39===e.keyCode?(self.scrollToPosition("down"),e.preventDefault(),!1):36===e.keyCode?(self.scrollToPosition("top"),e.preventDefault(),!1):35===e.keyCode?(self.scrollToPosition("bottom"),e.preventDefault(),!1):void 0}),self.options.scrollButtons&&(self.options.scrollButtons.up&&self.options.scrollButtons.up.on("click",function(e){e.preventDefault(),self.scrollToPosition("up")}),self.options.scrollButtons.down&&self.options.scrollButtons.down.on("click",function(e){e.preventDefault(),self.scrollToPosition("down")})),self.options.curtainLinks&&$(self.options.curtainLinks).on("click",function(e){e.preventDefault();var href=$(this).attr("href");if(!self.isHashIsOnList(href.substring(1))&&position)return!1;var position=self.$elDatas[$(href).index()]["data-position"]||null;return position&&($.iOs4||!$.iPhone&&!$.iPad?self.scrollEl.animate({scrollTop:position},self.options.scrollSpeed,self.options.easing):$("body").animate({scrollTop:position},self.options.scrollSpeed,self.options.easing)),!1}),self.$window.on("hashchange",function(){self._ignoreHashChange===!1&&self.isHashIsOnList(location.hash.substring(1)),self._ignoreHashChange=!1})},setBodyHeight:function(){var h=0;for(var key in this.$elDatas){var obj=this.$elDatas[key];h+=obj["data-height"]}this.options.bodyHeight=h,$("body").height(h)},setLinks:function(){var self=this;this.$li.each(function(){var id=$(this).attr("id")||0;self.options.linksArray.push(id)})},setHash:function(hash){el=$("[href=#"+hash+"]"),el.parent().siblings("li").removeClass("active"),el.parent().addClass("active"),history.pushState?history.pushState(null,null,"#"+hash):location.hash=hash},setCache:function(){var self=this;self.$current=self.$element.find(".current"),self.$fixed=self.$current.find(".fixed"),self.$fixedLength=self.$fixed.length,self.$step=self.$current.find(".step"),self.$stepLength=self.$step.length,self.currentIndex=self.$current.index(),self.currentP=self.$elDatas[self.currentIndex]["data-position"],self.currentHeight=self.$elDatas[self.currentIndex]["data-height"],self.parallaxBg=self.$current.attr("data-parallax-background"),self.$fade=self.$current.find("[data-fade]"),self.$slowScroll=self.$current.find("[data-slow-scroll]")},isHashIsOnList:function(hash){var self=this;$.each(self.options.linksArray,function(i,val){return val===hash?(self.scrollToPosition(hash),!1):void 0})},readyElement:function(el,callback){var interval=setInterval(function(){el.length&&(callback(el.length),clearInterval(interval))},60)},imageLoaded:function(callback){var self=this,elems=self.$element.find("img"),len=elems.length,blank="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";elems.bind("load.imgloaded",function(){(--len<=0&&this.src!==blank||$(this).not(":visible"))&&(elems.unbind("load.imgloaded"),callback.call(elems,this))}).each(function(){if(this.complete||this.complete===undefined){var src=this.src;this.src=blank,this.src=src}})}},$.fn[pluginName]=function(options){return this.each(function(){$.data(this,"plugin_"+pluginName)||$.data(this,"plugin_"+pluginName,new Plugin(this,options))})}}(jQuery,window,document);$(document).ready(function(){$("body > ol > li > article").flexVerticalCenter(),$(".curtains").curtain({scrollSpeed:400,curtainLinks:".down"}),$("#share > a").on("click",function(){return $("#share > ul").toggle(),!1})});